library(dgof)

##################constants
min1=50
max1=100
min2=0 #50#40 #30#20#10#
max2=50 #100#90 #80#70#60#
n=100
min_p=0.05

######################building data sets
df1<-data.frame(xs=runif(n, min = min1, max = max1),ys=as.factor(0))
df2<-data.frame(xs=runif(n, min = min2, max =max2),ys=as.factor(1))
######################
findOV <- function(part_size){
    part_num= n/part_size
    big_step= (max1-min1)/part_num
    small_step=(max1-min1)/ n
    overlaped <- data.frame(matrix(ncol=4,nrow=0))
    i<-min1
    while(i <max1){
        i2<- i+big_step
        dt1<- df1[df1[,1]<(i2) & df1[,1]>i,]
        dt2<- df2[df2[,1]<(i2) & df2[,1]>i,]
        tryCatch(
            {t<- ks.test(dt1[,1],dt2[,1])
            if(t$p.value>=min_p){
                n1<-nrow(df1[df1[,1]>i & df1[,1]<(i2),])/n*100
                overlaped<- rbind(overlaped,c(t$p.value,i,min(i2,max1),n1))
                i<-i2-small_step
                }
            },
        error = function(e){
                print("bye")
                print(i)} 
            )
        i<-i+small_step
    }
    colnames(overlaped)<- c("pvalue","x1start","x1stop","size") 
    print("----------");
    print(part_size);
    print(overlaped)
    ov<-0
    for(j in 1:nrow(overlaped)){
        ov=ov+nrow(df1[df1[,1]>overlaped[j,2] & df1[,1]<overlaped[j,3],])
    }
    ov_size=ov/n*100
    print(ov_size)
    print("===============");
}

#################################################test 100
[1] "----------"
[1] 10
       pvalue x1start x1stop size
1  0.14016721      50     55   12
2  0.57288772      55     60    8
3  0.68067227      60     65    5
4  0.65837048      65     70   13
5  0.15714286      71     76   13
6  0.07285862      76     81   13
7  0.62637363      81     86    9
8  0.06961181      87     92    9
9  0.57876206      92     97   10
10 0.91608392      97    100    5
[1] 97
[1] "==============="
[1] "----------"
[1] 20
      pvalue x1start x1stop size
1 0.17078716      50     60   20
2 0.40923536      60     70   18
3 0.07249461      70     80   27
4 0.49673034      80     90   17
5 0.70055538      90    100   18
[1] 100
[1] "==============="
[1] "----------"
[1] 30
      pvalue x1start x1stop size
1 0.12363761      50     65   25
2 0.08829941      66     81   38
3 0.56549020      81     96   25
4 0.75597841      96    100    9
[1] 97
[1] "==============="
[1] "----------"
[1] 40
     pvalue x1start x1stop size
1 0.4164520      50     70   38
2 0.1176149      75     95   42
3 0.9557156      95    100    9
[1] 89
[1] "==============="
[1] "----------"
[1] 50
      pvalue x1start x1stop size
1 0.30911061      50     75   49
2 0.05493038      75    100   51
[1] 100
[1] "==============="
[1] "----------"
[1] 60
      pvalue x1start x1stop size
1 0.05865967    57.5   87.5   59
2 0.44636382    87.5  100.0   24
[1] 83
[1] "==============="
[1] "----------"
[1] 70
      pvalue x1start x1stop size
1 0.05045345      53     88   66
2 0.14427963      88    100   24
[1] 90
[1] "==============="
[1] "----------"
[1] 80
      pvalue x1start x1stop size
1 0.07995749      50     90   82
2 0.70055538      90    100   18
[1] 100
[1] "==============="
[1] "----------"
[1] 90
     pvalue x1start x1stop size
1 0.1265834      50     95   91
2 0.9557156      95    100    9
[1] 100
[1] "==============="
[1] "----------"
[1] 100
     pvalue x1start x1stop size
1 0.4675586      50    100  100
[1] 100
[1] "==============="
##################################80
[1] "----------"
[1] 10
     pvalue x1start x1stop size
1 0.1495594      50     55    8
2 0.4275153      55     60   16
3 0.9890883      60     65   10
4 0.6684211      65     70    3
5 0.1799904      70     75   15
6 0.4334122      75     80   10
7 0.5751748      80     85    7
8 0.8533508      85     90   14
[1] 83
[1] "==============="
[1] "----------"
[1] 20
      pvalue x1start x1stop size
1 0.05667802      50     60   24
2 0.10762444      60     70   13
3 0.27866558      70     80   25
4 0.95499185      80     90   21
[1] 83
[1] "==============="
[1] "----------"
[1] 30
      pvalue x1start x1stop size
1 0.34295470    50.0     65   34
2 0.05386504    67.0     82   32
3 0.08658009    88.5    100   20
[1] 86
[1] "==============="
[1] "----------"
[1] 40
      pvalue x1start x1stop size
1 0.07852528    50.5   70.5   36
2 0.41796881    70.5   90.5   45
[1] 81
[1] "==============="
[1] "----------"
[1] 50
      pvalue x1start x1stop size
1 0.29291397    50.0     75   52
2 0.08658009    88.5    100   20
[1] 72
[1] "==============="
###############################60
[1] "----------"
[1] 10
     pvalue x1start x1stop size
1 0.1255658      50     55   16
2 0.1495594      55     60   12
3 0.2176573      60     65    9
4 0.7395809      65     70    9
5 0.8318247      70     75    8
6 0.8383838      75     80    5
[1] 59
[1] "==============="
[1] "----------"
[1] 20
     pvalue x1start x1stop size
1 0.2520456      50     60   28
2 0.8720092      60     70   18
3 0.8818059      70     80   13
[1] 59
[1] "==============="
[1] "----------"
[1] 30
     pvalue x1start x1stop size
1 0.3196979      50     65   37
2 0.8815598      65     80   22
[1] 59
[1] "==============="
[1] "----------"
[1] 40
     pvalue x1start x1stop size
1 0.1791963      50     70   46
[1] 46
[1] "==============="
[1] "----------"
[1] 50
      pvalue x1start x1stop size
1 0.08091444      50     75   54
[1] 54
[1] "==============="
####################################40
[1] "----------"
[1] 10
     pvalue x1start x1stop size
1 0.3641789      50     55   10
2 0.9789387      55     60    9
3 0.8730159      60     65    5
4 0.9796380      65     70   11
[1] 35
[1] "==============="
[1] "----------"
[1] 20
     pvalue x1start x1stop size
1 0.6419103      50     60   19
2 0.8715081      60     70   16
[1] 35
[1] "==============="
[1] "----------"
[1] 30
     pvalue x1start x1stop size
1 0.6922779      50     65   24
[1] 24
[1] "==============="
[1] "----------"
[1] 40
     pvalue x1start x1stop size
1 0.5401833      50     70   35
[1] 35
[1] "==============="
[1] "----------"
[1] 50
      pvalue x1start x1stop size
1 0.07000259      50     75   44
[1] 44
[1] "==============="
################################20
[1] "----------"
[1] 10
     pvalue x1start x1stop size
1 0.9791022      50     55    4
2 0.3728050      55     60    7
[1] 11
[1] "==============="
[1] "----------"
[1] 20
     pvalue x1start x1stop size
1 0.3124033      50     60   11
[1] 11
[1] "==============="
[1] "----------"
[1] 30
[1] pvalue  x1start x1stop  size   
<0 rows> (or 0-length row.names)
[1] 100
[1] "==============="
#############################0
[1] "----------"
[1] 10
[1] pvalue  x1start x1stop  size   
<0 rows> (or 0-length row.names)
[1] 100
[1] "==============="

